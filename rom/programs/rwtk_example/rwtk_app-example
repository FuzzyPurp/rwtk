-----------------------------------------------------------------------------
-- Redworks Toolkit Example Application
-- Author: MewK
--
-- This program is released under the MIT License (MIT).
-----------------------------------------------------------------------------

local myApplication
local myConfig
local myLayer
local mySaveAsDialog

-- Create Application
myApplication = rwtk_app.create({
	-- onStart
	onStart = function(self)
		-- Load config
		myConfig = rwtk_app_config.load('myConfig.conf', {
			counter = 1,
			subCounter = 1
		})
	end,
	
	-- onStop
	onStop = function(self)
		-- Save config
		rwtk_app_config.save('myConfig.conf', myConfig)
	end,
	
	-- onKey
	onKey = function(self, keyCode)
		if keyCode == 18 then	-- E
			self:stop()
		end
	end
})

-- Create Main Layer
myLayer = rwtk_app_layer.create({
	border = false,
	visible = true,
	menu = {
		align = 'bottom',
		items = {
			{
				text = 'File',
				items = {
					{ 
						text = 'Clear',
						onAction = function(self)
							myConfig.counter = 0
							myConfig.subCounter = 0
						end
					}, { 
						text = 'Surprise',
						keyCode = 31, -- S
						onAction = function(self)
							self.parent:getLayer('mySaveAsDialog').visible = true
							self.parent:focusLayer('mySaveAsDialog')
						end
					}
				}
			}, { 
				text = 'Exit',
				keyCode = 18, -- E
				onAction = function(self)
					self.parent:stop()
				end
			}
		}
	},

	onDraw = function(self, innerX, innerY, innerWidth, innerHeight)
		for i = 1, myConfig.counter do
			term.write('O')
			if i % innerWidth == 0 then
				term.setCursorPos(innerX, innerY + math.floor(i / innerWidth))
			end
		end
	end,
	
	onKey = function(self, keyCode)
		myConfig.counter = myConfig.counter + 1
	end
})

-- Create Save As Dialog
mySaveAsDialog = rwtk_app_layer.create({
	width = 32, 
	height = 14,
	title = 'Surprise',
	menu = {
		items = {
			{
				text = 'Foo',
				items = {
					{ 
						text = 'Close',
						onAction = function(self)
							self.visible = false
							self.parent:focusLayer('myLayer')
						end
					}
				}
			}
		}
	},
	components = {
		rwtk_app_component_label.create({
			x = 1,
			y = 1,
			width = 10,
			height = 4,
			text = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer a dolor quis orci consequat dapibus. Fusce interdum cursus vestibulum. Donec odio lectus, vulputate et elementum quis, dignissim id nisi. Sed.'
		})
	},

	onDraw = function(self, innerX, innerY, innerWidth, innerHeight)
		-- for i = 1, myConfig.subCounter do
			-- term.write('X')
			-- if i % innerWidth == 0 then
				-- term.setCursorPos(innerX, innerY + math.floor(i / innerWidth))
			-- end
		-- end
	end,
	
	onKey = function(self, keyCode)
		-- myConfig.subCounter = myConfig.subCounter + 1
	end
})

-- Prepare application
myApplication:addLayer('myLayer', myLayer)
myApplication:addLayer('mySaveAsDialog', mySaveAsDialog)
myApplication:focusLayer('myLayer');
		
-- Start application
myApplication:start()